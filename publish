#!/usr/bin/env bash

# Script for publishing https://github.com/partio-scout/kipa results
# @author ville.pekkinen@gmail.com, 2022

set -o errexit
set -o nounset

main() {

  if [[ $# -eq 0 ]]; then
    echo "No class numbers provided!"
    echo "Usage, for example: ./publish 22 23 24"
    exit 1
  fi  

  if [[ -f ".env" ]]; then
    source ".env"
  else
    echo "Could not find .env file!"
    exit 1
  fi


  TIMESTAMP=$(date)
  
  for CLASS in "$@"; do
    RESULT_FILE="${RESULT_REPO_DIR}/${CLASS}.html"
    RESULT_URL="http://localhost:3000/kipa/kierikki/tulosta/tuloste/sarja/${CLASS}/"
    curl --verbose --fail --output "${RESULT_FILE}" "${RESULT_URL}"
  done

  cd ${RESULT_REPO_DIR}
 
  git add .

  if git commit -m "${TIMESTAMP}"; then
    git push
  fi
}

main "$@"